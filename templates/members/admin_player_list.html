{% extends "base.html" %}
{% block content %}
<div class="row">
  <!-- Total Players -->
  <div class="col-lg-3 col-6">
    <div class="small-box bg-info">
      <div class="inner"><h3>{{ total_players }}</h3><p>Total Players</p></div>
      <div class="icon"><i class="fas fa-users"></i></div>
    </div>
  </div>
  <!-- Updated in last 12 months -->
  <div class="col-lg-3 col-6">
    <div class="small-box bg-success">
      <div class="inner"><h3>{{ recent_updates }}</h3><p>Updated Last 12 Months</p></div>
      <div class="icon"><i class="fas fa-sync-alt"></i></div>
    </div>
  </div>
  <!-- Gender diversity -->
  <div class="col-lg-3 col-6">
    <div class="small-box bg-warning">
      <div class="inner"><h3>{{ totals_by_gender|length }}</h3><p>Genders</p></div>
      <div class="icon"><i class="fas fa-venus-mars"></i></div>
    </div>
  </div>
  <!-- Inactive players -->
  <div class="col-lg-3 col-6">
    <div class="small-box bg-danger">
      <div class="inner"><h3>{{ inactive_players }}</h3><p>Inactive > 12 Months</p></div>
      <div class="icon"><i class="fas fa-user-slash"></i></div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Membership Types -->
  <div class="col-lg-3 col-6">
    <div class="small-box bg-primary">
      <div class="inner">
        <h3>{{ membership_types|length }}</h3>
        <p>Membership Types</p>
      </div>
      <div class="icon"><i class="fas fa-id-card"></i></div>
    </div>
  </div>
  <!-- Age Distribution -->
  <div class="col-lg-3 col-6">
    <div class="small-box bg-secondary">
      <div class="inner">
        <h3>{{ age_distribution.Adults }}</h3>
        <p>Adults</p>
      </div>
      <div class="icon"><i class="fas fa-birthday-cake"></i></div>
    </div>
  </div>
  <!-- Questionnaire completion -->
  <div class="col-lg-3 col-6">
    <div class="small-box bg-success">
      <div class="inner">
        <h3>{{ questionnaire_completion }}%</h3>
        <p>Questionnaire Completion</p>
      </div>
      <div class="icon"><i class="fas fa-clipboard-check"></i></div>
    </div>
  </div>
  <!-- Access logs today -->
  <div class="col-lg-3 col-6">
    <div class="small-box bg-info">
      <div class="inner">
        <h3>{{ today_access_logs }}</h3>
        <p>Player Records Viewed Today</p>
      </div>
      <div class="icon"><i class="fas fa-eye"></i></div>
    </div>
  </div>
</div>

<!-- Upcoming birthdays -->
<div class="card">
  <div class="card-header"><h3 class="card-title">Upcoming Birthdays (Next 30 Days)</h3></div>
  <div class="card-body">
    {% if upcoming_birthdays %}
      <ul>
      {% for p in upcoming_birthdays %}
        <li>{{ p.first_name }} {{ p.last_name }} – {{ p.date_of_birth|date:"j M" }}</li>
      {% endfor %}
      </ul>
    {% else %}
      <p>No upcoming birthdays.</p>
    {% endif %}
  </div>
</div>

<div class="card">
  <div class="card-header"><h3 class="card-title">Player List</h3></div>
  <div class="card-body">
    <form method="get" class="form-inline mb-2">
      <label class="mr-2">Team:</label>
      <select name="team" class="form-control mr-3" onchange="this.form.submit()">
        <option value="">All</option>
        {% for team in teams %}
          <option value="{{ team.id }}" {% if request.GET.team == team.id|stringformat:"s" %}selected{% endif %}>{{ team.name }}</option>
        {% endfor %}
      </select>
      <label class="mr-2">Type:</label>
      <select name="player_type" class="form-control" onchange="this.form.submit()">
        <option value="">All</option>
        {% for pt in player_types %}
          <option value="{{ pt.id }}" {% if request.GET.player_type == pt.id|stringformat:"s" %}selected{% endif %}>{{ pt.name }}</option>
        {% endfor %}
      </select>
    </form>
    <table class="table table-striped">
      <thead><tr><th>Name</th><th>Gender</th><th>Type</th><th>Teams</th><th>Actions</th></tr></thead>
      <tbody>
        {% for p in players %}
        <tr>
          <td>{{ p.first_name }} {{ p.last_name }}</td>
          <td>{{ p.get_gender_display }}</td>
          <td>{{ p.player_type }}</td>
          <td>
            {% for m in p.team_memberships.all %}
              <span class="badge badge-info">{{ m.team.name }}</span>
            {% empty %}—{% endfor %}
          </td>
          <td><a href="{% url 'admin_player_detail' p.id %}" class="btn btn-sm btn-primary">View</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
