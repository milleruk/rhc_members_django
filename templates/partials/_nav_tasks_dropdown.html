{% load humanize %}
<li class="nav-item dropdown">
    <a class="nav-link" data-toggle="dropdown" href="#">
        <i class="far fa-bell"></i>
        {% if open_task_count %}<span class="badge badge-warning navbar-badge">{{ open_task_count }}</span>{% endif %}
    </a>
    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
        <span class="dropdown-item dropdown-header">{{ open_task_count|default:0 }} Notifications</span>
        {% if task_notifications %}
            <div class="dropdown-divider"></div>
            {% for n in task_notifications %}
                <a href="{{ n.url }}" class="dropdown-item d-flex align-items-start">
                    <i class="mr-2 mt-1 {% if n.overdue %}fas fa-exclamation-triangle text-danger {% elif n.due_at %}far fa-calendar text-info {% else %}far fa-clipboard text-muted{% endif %}"></i>
                    <div class="flex-fill">
                        <div class="small font-weight-bold text-wrap">{{ n.title }}</div>
                        {% if n.subject %}<div class="text-muted small text-truncate">for {{ n.subject }}</div>{% endif %}
                        <div class="text-muted text-sm">
                            {% if n.due_at %}
                                Due {{ n.due_at|naturaltime }}
                            {% else %}
                                No due date
                            {% endif %}
                        </div>
                    </div>
                </a>
                {% if not forloop.last %}<div class="dropdown-divider"></div>{% endif %}
            {% endfor %}
        {% else %}
            <div class="dropdown-divider"></div>
            <div class="dropdown-item text-muted small">No open tasks.</div>
        {% endif %}
        <div class="dropdown-divider"></div>
        <a href="{% url 'tasks:my_list' %}"
           class="dropdown-item dropdown-footer">See All Tasks</a>
    </div>
</li>
